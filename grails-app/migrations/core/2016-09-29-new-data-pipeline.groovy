package core
databaseChangeLog = {

	changeSet(author: "henri", id: "new-data-pipeline-1") {
		sql("""
			UPDATE feed SET
				realtime_feed = 'com.unifina.feed.redis.RedisFeed',
				backtest_feed = 'com.unifina.feed.cassandra.CassandraHistoricalFeed',
				discovery_util_class = NULL,
				key_provider_class = 'com.unifina.feed.StreamrBinaryMessageKeyProvider',
				message_source_class = 'com.unifina.feed.redis.MultipleRedisMessageSource',
				parser_class = 'com.unifina.feed.StreamrBinaryMessageParser',
				stream_listener_class = 'com.unifina.feed.cassandra.CassandraDeletingStreamListener',
				field_detector_class = 'com.unifina.feed.cassandra.CassandraFieldDetector',
				data_range_provider_class = 'com.unifina.feed.cassandra.CassandraDataRangeProvider'
				WHERE `id` = '7';
		""")
	}

	changeSet(author: "new-data-pipeline-2", id: "1474977762795-1") {
		addColumn(tableName: "stream") {
			column(name: "partitions", type: "integer", defaultValue: 1) {
				constraints(nullable: "false")
			}
		}
	}

	changeSet(author: "henri", id: "new-data-pipeline-test", context: "test") {
		sql("""
			INSERT INTO `stream` (`version`, `api_key`, `description`, `feed_id`, `first_historical_day`, `last_historical_day`, `name`, `config`, `user_id`, `id`, `class`, `date_created`, `last_updated`, `partitions`)
			VALUES
			\t(1, 'm3CoiiUNQlami6NE8zucTw', NULL, 7, NULL, NULL, 'LiveSpec-SendToStream', '{\\"fields\\":[{\\"name\\":\\"count\\",\\"type\\":\\"number\\"}]}', 1, '4jFT4_yRSFyElSj9pHmovg', 'com.unifina.domain.data.Stream', '2016-09-28 13:53:58', '2016-09-28 13:59:07', 1);
		""")
		sql("""
			INSERT INTO `canvas` (`id`, `version`, `adhoc`, `date_created`, `example`, `has_exports`, `json`, `last_updated`, `name`, `request_url`, `runner`, `serialization_time`, `serialized`, `server`, `state`, `user_id`)
			VALUES
			\t('TDl025VRQbqgY2DpQK4mRg', 36, 00000000, '2016-09-28 13:35:27', 00000000, 00000000, '{\\"name\\":\\"LiveSpec-SendToStream\\",\\"modules\\":[{\\"id\\":161,\\"inputs\\":[{\\"id\\":\\"ep_qsg4iRdZSB-Pq0IcmxS_9A\\",\\"canConnect\\":true,\\"name\\":\\"in\\",\\"connected\\":true,\\"drivingInput\\":true,\\"longName\\":\\"Count.in\\",\\"type\\":\\"Object\\",\\"acceptedTypes\\":[\\"Object\\"],\\"requiresConnection\\":true,\\"canToggleDrivingInput\\":true,\\"sourceId\\":\\"ep_hSbwDnGTRd2t54CL_pBS-A\\"}],\\"hash\\":1,\\"canClearState\\":true,\\"layout\\":{\\"position\\":{\\"left\\":\\"338px\\",\\"top\\":\\"46px\\"}},\\"name\\":\\"Count\\",\\"params\\":[{\\"id\\":\\"ep_MEWPuw9DTGa88peQjYUyVw\\",\\"canConnect\\":true,\\"name\\":\\"windowLength\\",\\"connected\\":false,\\"drivingInput\\":false,\\"longName\\":\\"Count.windowLength\\",\\"value\\":0,\\"type\\":\\"Double\\",\\"defaultValue\\":0,\\"acceptedTypes\\":[\\"Double\\"],\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":true},{\\"id\\":\\"ep_0SRppr4tRKyErRy6C-7nNQ\\",\\"canConnect\\":true,\\"possibleValues\\":[{\\"name\\":\\"events\\",\\"value\\":\\"EVENTS\\"},{\\"name\\":\\"seconds\\",\\"value\\":\\"SECONDS\\"},{\\"name\\":\\"minutes\\",\\"value\\":\\"MINUTES\\"},{\\"name\\":\\"hours\\",\\"value\\":\\"HOURS\\"},{\\"name\\":\\"days\\",\\"value\\":\\"DAYS\\"}],\\"name\\":\\"windowType\\",\\"connected\\":false,\\"drivingInput\\":false,\\"longName\\":\\"Count.windowType\\",\\"value\\":\\"EVENTS\\",\\"type\\":\\"String\\",\\"defaultValue\\":\\"events\\",\\"acceptedTypes\\":[\\"String\\"],\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":true},{\\"id\\":\\"ep_3r7oc8dxQzquNpY_fUSzQw\\",\\"canConnect\\":true,\\"name\\":\\"minSamples\\",\\"connected\\":false,\\"drivingInput\\":false,\\"longName\\":\\"Count.minSamples\\",\\"value\\":0,\\"type\\":\\"Double\\",\\"defaultValue\\":0,\\"acceptedTypes\\":[\\"Double\\"],\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":true}],\\"type\\":\\"module\\",\\"outputs\\":[{\\"id\\":\\"ep_tYYg4QvzSQGOkr7wb-k0pw\\",\\"canConnect\\":true,\\"canBeNoRepeat\\":true,\\"name\\":\\"count\\",\\"connected\\":true,\\"longName\\":\\"Count.count\\",\\"noRepeat\\":true,\\"type\\":\\"Double\\",\\"targets\\":[\\"ep_uBfpd87JSs2bVIhMJGTPAA\\",\\"ep_qnB2eF2XQNSbK9jsWUS-cQ\\"]}],\\"jsModule\\":\\"GenericModule\\"},{\\"hash\\":2,\\"tableConfig\\":{\\"headers\\":[\\"timestamp\\",\\"count\\"]},\\"uiChannel\\":{\\"id\\":\\"F8_rgQRDR-ODa8oeW_VWkA\\",\\"webcomponent\\":\\"streamr-table\\",\\"name\\":\\"Table\\"},\\"params\\":[],\\"type\\":\\"module event-table-module\\",\\"id\\":527,\\"inputs\\":[{\\"canConnect\\":true,\\"connected\\":true,\\"jsClass\\":\\"VariadicInput\\",\\"type\\":\\"Object\\",\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":false,\\"sourceId\\":\\"ep_tYYg4QvzSQGOkr7wb-k0pw\\",\\"id\\":\\"ep_qnB2eF2XQNSbK9jsWUS-cQ\\",\\"variadic\\":{\\"isLast\\":false,\\"index\\":1},\\"name\\":\\"endpoint-1475069711012\\",\\"drivingInput\\":true,\\"longName\\":\\"Table.endpoint-1475069711012\\",\\"displayName\\":\\"in1\\",\\"acceptedTypes\\":[\\"Object\\"]},{\\"canConnect\\":true,\\"export\\":false,\\"connected\\":false,\\"jsClass\\":\\"VariadicInput\\",\\"type\\":\\"Object\\",\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":false,\\"id\\":\\"myId_2_1475069714722\\",\\"variadic\\":{\\"isLast\\":true,\\"index\\":2},\\"name\\":\\"endpoint1475069714721\\",\\"drivingInput\\":true,\\"longName\\":\\"Table.endpoint1475069714721\\",\\"displayName\\":\\"in2\\",\\"acceptedTypes\\":[\\"Object\\"]}],\\"canClearState\\":true,\\"layout\\":{\\"position\\":{\\"left\\":\\"1218px\\",\\"top\\":\\"49px\\"}},\\"name\\":\\"Table\\",\\"outputs\\":[],\\"jsModule\\":\\"TableModule\\",\\"options\\":{\\"uiResendLast\\":{\\"value\\":0,\\"type\\":\\"int\\"},\\"maxRows\\":{\\"value\\":20,\\"type\\":\\"int\\"},\\"uiResendAll\\":{\\"value\\":false,\\"type\\":\\"boolean\\"}}},{\\"id\\":209,\\"inputs\\":[],\\"hash\\":3,\\"canClearState\\":true,\\"layout\\":{\\"position\\":{\\"left\\":\\"64px\\",\\"top\\":\\"58px\\"}},\\"name\\":\\"Clock\\",\\"params\\":[{\\"id\\":\\"ep_Rw1vfMtORdaajsIONqLrBQ\\",\\"canConnect\\":true,\\"name\\":\\"format\\",\\"connected\\":false,\\"drivingInput\\":false,\\"longName\\":\\"Clock.format\\",\\"value\\":\\"yyyy-MM-dd HH:mm:ss z\\",\\"type\\":\\"String\\",\\"defaultValue\\":\\"yyyy-MM-dd HH:mm:ss z\\",\\"acceptedTypes\\":[\\"String\\"],\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":true}],\\"type\\":\\"module\\",\\"outputs\\":[{\\"id\\":\\"ep_hSbwDnGTRd2t54CL_pBS-A\\",\\"canConnect\\":true,\\"canBeNoRepeat\\":true,\\"name\\":\\"date\\",\\"connected\\":true,\\"longName\\":\\"Clock.date\\",\\"noRepeat\\":true,\\"type\\":\\"String\\",\\"targets\\":[\\"ep_qsg4iRdZSB-Pq0IcmxS_9A\\"]},{\\"id\\":\\"ep_nLcbzr4vQS-gyEYhtAbxhQ\\",\\"canConnect\\":true,\\"canBeNoRepeat\\":true,\\"name\\":\\"timestamp\\",\\"connected\\":false,\\"longName\\":\\"Clock.timestamp\\",\\"noRepeat\\":true,\\"type\\":\\"Double\\"}],\\"jsModule\\":\\"GenericModule\\"},{\\"id\\":197,\\"inputs\\":[{\\"feedback\\":false,\\"canConnect\\":true,\\"id\\":\\"ep_uBfpd87JSs2bVIhMJGTPAA\\",\\"canBeFeedback\\":false,\\"drivingInput\\":true,\\"connected\\":true,\\"name\\":\\"count\\",\\"canHaveInitialValue\\":false,\\"longName\\":\\"SendToStream.count\\",\\"type\\":\\"Double\\",\\"requiresConnection\\":false,\\"acceptedTypes\\":[\\"Double\\"],\\"canToggleDrivingInput\\":false,\\"sourceId\\":\\"ep_tYYg4QvzSQGOkr7wb-k0pw\\"}],\\"hash\\":4,\\"canClearState\\":true,\\"layout\\":{\\"position\\":{\\"left\\":\\"715px\\",\\"top\\":\\"162px\\"}},\\"name\\":\\"SendToStream\\",\\"params\\":[{\\"feedFilter\\":7,\\"canConnect\\":true,\\"updateOnChange\\":true,\\"connected\\":false,\\"type\\":\\"Stream\\",\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":false,\\"streamName\\":\\"LiveSpec-SendToStream\\",\\"id\\":\\"ep_B8lD1ohEQdyEWBzKuLKoCQ\\",\\"name\\":\\"stream\\",\\"drivingInput\\":false,\\"longName\\":\\"SendToStream.stream\\",\\"value\\":\\"4jFT4_yRSFyElSj9pHmovg\\",\\"feed\\":7,\\"defaultValue\\":null,\\"acceptedTypes\\":[\\"Stream\\",\\"String\\"]}],\\"type\\":\\"module\\",\\"outputs\\":[],\\"jsModule\\":\\"GenericModule\\"},{\\"hash\\":6,\\"tableConfig\\":{\\"headers\\":[\\"timestamp\\",\\"count\\"]},\\"uiChannel\\":{\\"id\\":\\"cQqKQ-NeTw6nHWmNRYp05g\\",\\"webcomponent\\":\\"streamr-table\\",\\"name\\":\\"Table\\"},\\"params\\":[],\\"type\\":\\"module event-table-module\\",\\"id\\":527,\\"inputs\\":[{\\"canConnect\\":true,\\"export\\":false,\\"connected\\":true,\\"jsClass\\":\\"VariadicInput\\",\\"type\\":\\"Object\\",\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":false,\\"sourceId\\":\\"ep_ml0N9ZBrTzetW6TP4gqStA\\",\\"id\\":\\"myId_6_1475071172798\\",\\"variadic\\":{\\"isLast\\":false,\\"index\\":2},\\"name\\":\\"endpoint1475071172797\\",\\"drivingInput\\":true,\\"longName\\":\\"Table.endpoint1475071172797\\",\\"displayName\\":\\"in2\\",\\"acceptedTypes\\":[\\"Object\\"]},{\\"canConnect\\":true,\\"export\\":false,\\"connected\\":false,\\"jsClass\\":\\"VariadicInput\\",\\"type\\":\\"Object\\",\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":false,\\"id\\":\\"myId_6_1475071182269\\",\\"variadic\\":{\\"isLast\\":true,\\"index\\":3},\\"name\\":\\"endpoint1475071182268\\",\\"drivingInput\\":true,\\"longName\\":\\"Table.endpoint1475071182268\\",\\"displayName\\":\\"in3\\",\\"acceptedTypes\\":[\\"Object\\"]}],\\"canClearState\\":true,\\"layout\\":{\\"position\\":{\\"left\\":\\"471px\\",\\"top\\":\\"331px\\"}},\\"name\\":\\"Table\\",\\"outputs\\":[],\\"options\\":{\\"uiResendLast\\":{\\"value\\":0,\\"type\\":\\"int\\"},\\"maxRows\\":{\\"value\\":20,\\"type\\":\\"int\\"},\\"uiResendAll\\":{\\"value\\":false,\\"type\\":\\"boolean\\"}},\\"jsModule\\":\\"TableModule\\"},{\\"id\\":147,\\"inputs\\":[],\\"hash\\":7,\\"canClearState\\":true,\\"name\\":\\"Stream\\",\\"layout\\":{\\"position\\":{\\"left\\":\\"87px\\",\\"top\\":\\"335px\\"}},\\"params\\":[{\\"canConnect\\":true,\\"updateOnChange\\":true,\\"connected\\":false,\\"type\\":\\"Stream\\",\\"requiresConnection\\":false,\\"canToggleDrivingInput\\":false,\\"streamName\\":\\"LiveSpec-SendToStream\\",\\"id\\":\\"ep_HHktPBVlSN-a61nTICFY6w\\",\\"name\\":\\"stream\\",\\"drivingInput\\":false,\\"value\\":\\"4jFT4_yRSFyElSj9pHmovg\\",\\"longName\\":\\"Stream.stream\\",\\"feed\\":7,\\"defaultValue\\":null,\\"acceptedTypes\\":[\\"Stream\\",\\"String\\"],\\"checkModuleId\\":true}],\\"outputs\\":[{\\"canBeNoRepeat\\":true,\\"canConnect\\":true,\\"id\\":\\"ep_ml0N9ZBrTzetW6TP4gqStA\\",\\"connected\\":true,\\"name\\":\\"count\\",\\"longName\\":\\"Stream.count\\",\\"noRepeat\\":false,\\"type\\":\\"Double\\",\\"targets\\":[\\"myId_6_1475071172798\\"]}],\\"type\\":\\"module\\",\\"jsModule\\":\\"StreamModule\\"}],\\"settings\\":{\\"editorState\\":{\\"runTab\\":\\"#tab-realtime\\"},\\"speed\\":\\"0\\",\\"timeOfDayFilter\\":{\\"timeOfDayStart\\":\\"00:00:00\\",\\"timeOfDayEnd\\":\\"23:59:00\\"},\\"endDate\\":\\"2016-04-12\\",\\"beginDate\\":\\"2016-04-11\\"},\\"hasExports\\":false,\\"uiChannel\\":{\\"id\\":\\"6mPRj-rITHyaimxbzr6LnQ\\",\\"webcomponent\\":null,\\"name\\":\\"Notifications\\"}}', '2016-09-29 08:25:56', 'LiveSpec-SendToStream', 'http://192.168.10.137:8081/unifina-core/api/v1/canvases/TDl025VRQbqgY2DpQK4mRg', 's-1475137545525', NULL, NULL, '192.168.10.137', 'stopped', 1);
		""")
	}

}
